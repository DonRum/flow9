import math/geometry;
import form/form;
import fusion;

export {
	VirtualScreenInfo : (
		size : Behaviour<WidthHeight>,
		position : Behaviour<PositionScale>,
		renderFn : (Form) -> void,
	);

	makeDefaultVirtualScreenInfo() -> VirtualScreenInfo;

	CropPopupByVirtualScreenBox(
		info : VirtualScreenInfo,
		popupContent : Form,
		popupSize : Behaviour<WidthHeight>,
		translateToVisibleArea : bool
	) -> Form;
}

makeDefaultVirtualScreenInfo() -> VirtualScreenInfo {
	VirtualScreenInfo(makeWH(), make(zeroPositionScale), nop1);
}

CropPopupByVirtualScreenBox(
	info : VirtualScreenInfo,
	popupContent : Form,
	popupSize : Behaviour<WidthHeight>,
	translateToVisibleArea : bool
) -> Form {
	windowXB = make(0.0);
	windowYB = make(0.0);
	Constructor(
		if (translateToVisibleArea) Translate(windowXB, windowYB, popupContent) else popupContent,
		make2Subscribe(info.size, popupSize, \size, windowWH -> {
			nextDistinct(windowXB, max(0.0, (size.width - windowWH.width) / 2.0));
			nextDistinct(windowYB, max(0.0, (size.height - windowWH.height) / 2.0));
		})
	);
}
