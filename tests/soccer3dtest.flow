import material/material_ui;

add3DMouseListeners(id : string, object : F3DObject, controlsLock : ref bool) {
	switch (object : F3DObject) {
		F3DScene(items): {
			F3DScene(fmapi(items, \i, it -> add3DMouseListeners(id + " " + i2s(i), it, controlsLock)));
		}
		default : {
			en = make(false);

			F3DTransformControls(
				F3DInteractive(
					object,
					[
						F3DMouseDown(\h -> {
							println("down" + id);

							if (!h) {
								next(en, true);
							}

							true;
						}),
						F3DMouseDown(\h -> {
							println("up" + id);

							h;
						})
					]
				),
				en
			)
		}
	}
}

main() {
	manager = makeMaterialManager([]);

	scene = F3DChildren(F3DSceneLoader("images/3d/soccer/soc_field.json"), \c -> add3DMouseListeners("", c, ref false));
	camera = F3DPosition(F3DPerspectiveCamera(const(50.0), const(1.0), const(0.01), const(6000.0)), make(0.0), make(0.0), make(1000.0));
	light = F3DPointLight(const(white), const(2.0), const(0.0), const(1.0));

	M3DStage(
		const(WidthHeight(1000.0, 1000.0)),
		scene,
		camera,
		[]
	)
	|> (\f -> MFrame(0.0, 4.0, [MStroke(getPrimaryColor(manager)), StrokeWidth(2.0)], f))
	|> (\f -> MBorder4(4.0, f))
	|> (\f -> mrender(manager, true, f))
}