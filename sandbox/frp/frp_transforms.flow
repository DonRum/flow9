import sandbox/frp/frp;

export {
	frpMerge2(f1 : Frp1<?>, f2 : Frp1<??>) -> Frp2<?, ??>;
	frpAdd(f : Frp2<double, double>) -> Frp1<double>;
}

frpMerge2(f1 : Frp1<?>, f2 : Frp1<??>) -> Frp2<?, ??> {
	s = fmake2(fget1(f1), fget1(f2));
	u1 = fsubscribe1(f1, \v -> {
		fnext2First(s, v)
	});
	faddDisposer2(s, u1);
	u2 = fsubscribe1(f2, \v -> {
		fnext2Second(s, v)
	});
	faddDisposer2(s, u2);
	s;
}

frpAdd(f : Frp2<double, double>) -> Frp1<double> {
	s = fmake1(fget2First(f) + fget2Second(f));
	us = fsubscribe2s(f, \v, w -> {
		fnext1(s, v + w);
	});
	faddDisposer1(s, us);
	s;
}
